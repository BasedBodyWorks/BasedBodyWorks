/*! For license information please see referral.js.LICENSE.txt */
(()=>{var e={2207:(e,t,n)=>{e.exports=n(7452)},7452:e=>{var t=function(e){"use strict";var t,n=Object.prototype,o=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,o){var r=t&&t.prototype instanceof g?t:g,i=Object.create(r.prototype),a=new E(o||[]);return i._invoke=function(e,t,n){var o=d;return function(r,i){if(o===f)throw new Error("Generator is already running");if(o===h){if("throw"===r)throw i;return L()}for(n.method=r,n.arg=i;;){var a=n.delegate;if(a){var s=S(a,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var l=u(e,t,n);if("normal"===l.type){if(o=n.done?h:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=h,n.method="throw",n.arg=l.arg)}}}(e,n,a),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d="suspendedStart",p="suspendedYield",f="executing",h="completed",y={};function g(){}function m(){}function v(){}var b={};l(b,i,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(j([])));x&&x!==n&&o.call(x,i)&&(b=x);var k=v.prototype=g.prototype=Object.create(b);function _(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(r,i,a,s){var l=u(e[r],e,i);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&o.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(d).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var r;this._invoke=function(e,o){function i(){return new t((function(t,r){n(e,o,t,r)}))}return r=r?r.then(i,i):i()}}function S(e,n){var o=e.iterator[n.method];if(o===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return y;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var r=u(o,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,y;var i=r.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function j(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function n(){for(;++r<e.length;)if(o.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:L}}function L(){return{value:t,done:!0}}return m.prototype=v,l(k,"constructor",v),l(v,"constructor",m),m.displayName=l(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,s,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},_(C.prototype),l(C.prototype,a,(function(){return this})),e.AsyncIterator=C,e.async=function(t,n,o,r,i){void 0===i&&(i=Promise);var a=new C(c(t,n,o,r),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},_(k),l(k,s,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var o=t.pop();if(o in e)return n.value=o,n.done=!1,n}return n.done=!0,n}},e.values=j,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(B),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(o,r){return s.type="throw",s.arg=e,n.next=o,r&&(n.method="next",n.arg=t),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;B(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,o){return this.delegate={iterator:j(e),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=t),y}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(2207),t=n.n(e);function o(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)e[o]=n[o]}return e}var r=function e(t,n){function r(e,r,i){if("undefined"!=typeof document){"number"==typeof(i=o({},n,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var s in i)i[s]&&(a+="; "+s,!0!==i[s]&&(a+="="+i[s].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+a}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],o={},r=0;r<n.length;r++){var i=n[r].split("="),a=i.slice(1).join("=");try{var s=decodeURIComponent(i[0]);if(o[s]=t.read(a,s),e===s)break}catch(e){}}return e?o[e]:o}},remove:function(e,t){r(e,"",o({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,o({},this.attributes,t))},withConverter:function(t){return e(o({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});const i=r;var a=["options"];function s(e,t,n,o,r,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function p(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var f=function(){function e(t){var n,o=t.options,r=void 0===o?{}:o,i=d(t,a);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i&&i.amount&&i.type&&i.sendData&&i.safelinkGeneratedCookie&&i.applyCoupon||console.debug("Invalid modal props",i),this.props=i,this.features=i.features;this.options=c(c({},{heading_text:"{Affiliate Name} sent you {Discount Value} off!",body_text:"Click below to redeem your discount code",button_text:"Redeem Coupon",widget_button_text:"Get {Affiliate First Name}'s {Discount Value} discount",background_color:"#FFFFFF",heading_color:"0C1B2F",body_color:"#9AAAB9",button_color:"#2C2C2C",button_border_color:"#535459",widget_button_color:"#4285FB",button_text_color:"#FFFFFF",helper_text:"Your discount will automatically be applied at checkout",helper_text_color:"#9AAAB9",widget_button_text_color:"#FFFFFF",widget_button_position:"bottom_right",widget_button_enabled:!0,emoji_enabled:!0}),r),this.variables={"Affiliate Name":i.affiliate_name,"Affiliate First Name":i.affiliate_first_name,"Affiliate Last Name":i.affiliate_last_name,"Discount Value":"percentage"===(null===(n=i.type)||void 0===n?void 0:n.toString().toLowerCase())?"".concat(i.amount,"%"):"".concat(i.currency_symbol||"$").concat(i.amount)}}var n,o,r,l,u;return n=e,o=[{key:"init",value:function(){var e=this;this.initialized&&this.unmount();var t=this.renderSafelinkModal(),n=this.renderWidgetButton();document.body.prepend(t),document.body.prepend(n),this.updateSafeLinkModalSize(),window.addEventListener("resize",(function(){return e.updateSafeLinkModalSize()})),new URLSearchParams(window.location.search).get("snowball")&&(localStorage.removeItem("snowball_safelink_modal_closed"),localStorage.removeItem("snowball_widget_button_closed")),this.wasModalClosed()?this.wasWidgetClosed()||this.showWidgetButton():this.showSafelinkModal(),this.initialized=!0}},{key:"unmount",value:function(){var e=this;this.initialized&&(this.modalOverlay.remove(),this.widgetButton.remove(),window.removeEventListener("resize",(function(){return e.updateSafeLinkModalSize()})),this.initialized=!1)}},{key:"showSafelinkModal",value:function(){this.modalOverlay&&(this.modalOverlay.style.display="block")}},{key:"hideSafelinkModal",value:function(){this.modalOverlay&&(this.modalOverlay.style.display="none"),this.options.widget_button_enabled&&this.showWidgetButton(),this.removeURLParams(),localStorage.setItem("snowball_safelink_modal_closed","true")}},{key:"showWidgetButton",value:function(){this.options.widget_button_enabled&&this.widgetButton&&(this.widgetButton.style.display="flex")}},{key:"hideWidgetButton",value:function(){this.widgetButton&&(this.widgetButton.style.display="none"),localStorage.setItem("snowball_widget_button_closed","true")}},{key:"showLoadingSpinner",value:function(){this.modalActionButton.style.display="none",this.modalInner.append(this.renderModalCodeBox()),this.modalCodeBox.innerHTML=" Loading...",this.modalCodeBox.prepend(this.renderLoadingSpinner())}},{key:"showSafelinkCode",value:function(){this.modalCodeBox.innerHTML="".concat(this.safelinkCode,' <img src="https://d2pnkb2a79l965.cloudfront.net/copy-blue-icon.png"\n            style="width: 22px; margin-bottom: -5px; display: inline;">'),this.modalInner.append(this.renderHelperText())}},{key:"renderSafelinkModal",value:function(){var e=this.renderModalOverlay(),t=this.renderModalContent(),n=this.renderModalInner(),o=this.renderModalCloseButton(),r=this.renderModalActionButton();return n.append(o),n.append(r),t.append(n),e.append(t),this.modalOverlay}},{key:"renderModalOverlay",value:function(){var e=this;return this.modalOverlay=document.createElement("div"),this.modalOverlay.id="__ss-modal-overlay",this.modalOverlay.style.cssText="\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0,0,0,.5);\n            z-index: 9998;",this.modalOverlay.addEventListener("click",(function(t){"__ss-modal-overlay"===t.target.id&&e.hideSafelinkModal()})),this.modalOverlay}},{key:"renderModalContent",value:function(){return this.modalContent=document.createElement("div"),this.modalContent.id="__ss-modal-content",this.modalContent.style.cssText="\n            display: block;\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            background-color: ".concat(this.options.background_color,";\n            z-index: 9999;\n            border-top: 10px solid #2C2C2C;\n            border-radius: 10px;\n            text-align: center;\n            margin: auto;"),this.modalContent}},{key:"renderModalInner",value:function(){return this.modalInner=document.createElement("div"),this.modalInner.id="__ss-modal-inner",this.modalInner.style.cssText="\n            box-sizing: border-box;\n            display: block;\n            position: relative;\n            width: 100%;\n            height: 100%;\n            padding: 40px 30px",this.modalInner.innerHTML='\n            <p style="text-align: center; '.concat(this.options.emoji_enabled?"":"display: none;",'">\n                <img src="https://d2pnkb2a79l965.cloudfront.net/party-popper-emoji.png"\n                    style="width: 80px; height: 80px; display: inline-block;">\n            </p>\n            <h2 style="\n                text-align: center;\n                font-size: 2.5em;\n                line-height: 1em;\n                margin: 0.5em auto;\n                font-family: -apple-system, Inter, BlinkMacSystemFont, Segoe UI, Roboto,\n                    Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji,\n                    Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;\n                font-weight: bold;\n                color: ').concat(this.options.heading_color,';\n            ">\n                ').concat(this.replaceVariables(this.options.heading_text),'\n            </h2>\n            <h3 style="\n                text-align: center;\n                font-size: 1.3em;\n                margin: 0.8em auto;\n                color: ').concat(this.options.body_color,';\n                font-family: -apple-system, Inter, BlinkMacSystemFont, Segoe UI, Roboto,\n                    Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji,\n                    Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;\n            ">\n                ').concat(this.replaceVariables(this.options.body_text),"\n            </h3>"),this.modalInner}},{key:"renderModalCloseButton",value:function(){var e=this;return this.modalCloseButton=document.createElement("button"),this.modalCloseButton.style.cssText="\n            position: absolute;\n            top: 10px;\n            right: 10px;\n            background-color: transparent;\n            border: none;\n            cursor: pointer;\n            width: auto;\n            text-align: center;",this.modalCloseButton.innerHTML='\n            <svg style="fill: '.concat(this.options.heading_color,'" height="25px" width="25px" id="Capa_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 490 490" xml:space="preserve">\n                <polygon points="456.851,0 245,212.564 33.149,0 0.708,32.337 212.669,245.004 0.708,457.678 33.149,490 245,277.443 456.851,490 489.292,457.678 277.331,245.004 489.292,32.337 "/>\n            </svg>'),this.modalCloseButton.addEventListener("click",(function(){return e.hideSafelinkModal()})),this.modalCloseButton}},{key:"renderModalActionButton",value:function(){var e=this;return this.modalActionButton=document.createElement("button"),this.modalActionButton.style.cssText="\n            display: block;\n            margin: 0 auto;\n            padding: 12px 20px;\n            width: 230px;\n            background-color: ".concat(this.options.button_color,";\n            color: ").concat(this.options.button_text_color,";\n            border: 1px solid ").concat(this.options.button_border_color,";\n            border-radius: 5px;\n            font-size: 1.2em;\n            cursor: pointer;\n            font-family: -apple-system, Inter, BlinkMacSystemFont,\n                Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji,\n                Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji; text-align: center;"),this.modalActionButton.innerHTML=this.replaceVariables(this.options.button_text),this.modalActionButton.addEventListener("click",(function(){return e.fetchDiscountCode()})),this.modalActionButton}},{key:"renderModalCodeBox",value:function(){var e=this;return this.modalCodeBox=document.createElement("div"),this.modalCodeBox.style.cssText="\n            background-color: #ECF0FF;\n            display: block;\n            width: 90%;\n            margin: auto;\n            text-align: center;\n            color: #3860FB;\n            font-size: 25px;\n            padding: 8px;\n            cursor: pointer;",this.modalCodeBox.addEventListener("click",(function(){e.safelinkCode&&(navigator.clipboard.writeText(e.safelinkCode),alert("Copied to clipboard"))})),this.modalCodeBox}},{key:"renderHelperText",value:function(){return this.modalHelperText=document.createElement("div"),this.modalHelperText.style.cssText="\n            font-size: 0.8em;\n            color: ".concat(this.options.helper_text_color,";\n            margin-top: 8px;"),this.modalHelperText.innerHTML="<em>".concat(this.replaceVariables(this.options.helper_text),"</em>"),this.modalHelperText}},{key:"renderLoadingSpinner",value:function(){return this.loadingSpinnerStyle=document.getElementById("__ss-loader-spinner-style"),this.loadingSpinnerStyle||(this.loadingSpinnerStyle=document.createElement("style"),this.loadingSpinnerStyle.id="__ss-loader-spinner-style",this.loadingSpinnerStyle.innerHTML="\n                .__ss-loader-spinner {\n                    width: 24px;\n                    height: 24px;\n                    border: 4px solid #3860FB;\n                    border-bottom-color: transparent;\n                    border-radius: 50%;\n                    display: inline-block;\n                    box-sizing: border-box;\n                    animation: __ss-rotation 1s linear infinite;\n                }\n\n                @keyframes __ss-rotation {\n                    0% {\n                        transform: rotate(0deg);\n                    }\n                    100% {\n                        transform: rotate(360deg);\n                    }\n                }",document.head.append(this.loadingSpinnerStyle)),this.loadingSpinner=document.createElement("span"),this.loadingSpinner.className="__ss-loader-spinner",this.loadingSpinner}},{key:"renderWidgetButton",value:function(){var e,t=this;return this.widgetButton=document.createElement("div"),this.widgetButton.id="__ss-widget-button",this.widgetButton.style.cssText="\n            display: none;\n            position: fixed;\n            bottom: 20px; ".concat("bottom_right"===this.options.widget_button_position?"right: 20px;":"left: 20px;","\n            padding: 10px 15px;\n            background-color: ").concat(this.options.widget_button_color,";\n            border-color: ").concat(this.options.widget_button_color,";\n            border-radius: 25px;\n            border-style: solid;\n            color: ").concat(this.options.widget_button_text_color,";\n            cursor: pointer;\n            z-index: 9999;\n            font-size: 16px;\n            width: auto;\n            text-align: center;\n            align-items: center;\n        "),this.widgetButtonContent=document.createElement("div"),this.widgetButtonContent.id="__ss-widget-button-content",this.widgetButtonContent.style.cssText="\n            display: inline-block;\n            align-items: center;",this.widgetButtonContent.innerHTML=this.replaceVariables(this.options.widget_button_text),this.widgetButton.append(this.widgetButtonContent),null!==(e=this.features)&&void 0!==e&&e.is_safelink_popup_close_widget_button_enabled&&this.widgetButton.append(this.renderWidgetCloseButton()),this.widgetButton.addEventListener("click",(function(){t.modalOverlay.style.display="block",t.widgetButton.style.display="none"})),this.widgetButton}},{key:"renderWidgetCloseButton",value:function(){var e=this;return this.widgetCloseButton=document.createElement("button"),this.widgetCloseButton.style.cssText="\n            background-color: transparent;\n            border: none;\n            cursor: pointer;\n            color: ".concat(this.options.widget_button_text_color,";\n            margin-left: 8px;\n            margin-top: 2px;\n            padding: 0px;\n            font-size: 20px;\n            opacity: 0.6;\n        "),this.widgetCloseButton.innerHTML="&times;",this.widgetCloseButton.addEventListener("click",(function(t){t.stopPropagation(),e.hideWidgetButton()})),this.widgetCloseButton.addEventListener("mouseenter",(function(){e.widgetCloseButton.style.opacity=1})),this.widgetCloseButton.addEventListener("mouseleave",(function(){e.widgetCloseButton.style.opacity=.6})),this.widgetCloseButton}},{key:"replaceVariables",value:function(e){var t=this;return e?e.replace(/{([^}]+)}/g,(function(e,n){return t.variables[n]||n})):e}},{key:"updateSafeLinkModalSize",value:function(){window.outerWidth<768?(this.modalContent&&(this.modalContent.style.cssText+="width: 90%;"),this.modalInner&&(this.modalInner.style.cssText+="padding: 40px 10px;")):(this.modalContent&&(this.modalContent.style.cssText+="width: 40%;"),this.modalInner&&(this.modalInner.style.cssText+="padding: 40px 30px 60px 30px;"))}},{key:"removeURLParams",value:function(){var e=new URLSearchParams(window.location.search);e.delete("snowball"),window.history.replaceState({},document.title,window.location.pathname+(e.size>0?"?":"")+e.toString())}},{key:"fetchDiscountCode",value:(l=t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.set(this.props.safelinkGeneratedCookie,"true",{secure:!0}),this.showLoadingSpinner(),e.next=4,this.props.sendData();case 4:if(!(n=e.sent).error){e.next=11;break}return console.error("Failed to create safelink"),alert("Failed to create safelink"),this.modalCodeBox.remove(),this.modalActionButton.style.display="block",e.abrupt("return");case 11:this.safelinkCode=n.safelink.code.code,this.props.applyCoupon(this.safelinkCode),this.showSafelinkCode();case 14:case"end":return e.stop()}}),e,this)})),u=function(){var e=this,t=arguments;return new Promise((function(n,o){var r=l.apply(e,t);function i(e){s(r,n,o,i,a,"next",e)}function a(e){s(r,n,o,i,a,"throw",e)}i(void 0)}))},function(){return u.apply(this,arguments)})},{key:"wasModalClosed",value:function(){return localStorage.getItem("snowball_safelink_modal_closed")}},{key:"wasWidgetClosed",value:function(){return localStorage.getItem("snowball_widget_button_closed")}}],o&&p(n.prototype,o),r&&p(n,r),Object.defineProperty(n,"prototype",{writable:!1}),e}();function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t,n,o,r,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function a(e){m(i,o,r,a,s,"next",e)}function s(e){m(i,o,r,a,s,"throw",e)}a(void 0)}))}}function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var w="snowball",x="snowball_affiliate_referral",k="snowball_visitor_id",_="snowball_last_join",C="snowball_expire_at",S="snowball_safelink",O="snowball_safelink_generated",B="snowball_referrer",E="snowball_referrer_blocked";const j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.referral=null,this.referral_applied=!1,this.referral_code=this.getReferralCodeFromUrl(w)||this.getCookieAffiliateReferralCode();var t=this.getReferralCodeFromUrl(w);t&&fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attributes:{__snowball:t}})}).then((function(e){return e.json()})).then((function(e){return console.debug("Snowball attribute set:",e)})).catch((function(e){return console.error("Failed to set snowball attribute:",e)})),this.payload={},this.referrer=this.getReferrer()}var n,o,r,a,s;return n=e,o=[{key:"getReferrer",value:function(){if(document.referrer&&""!=document.referrer)return document.referrer;var e=this.getCookieReferrer();return e&&""!=e&&null!=e?e:new URLSearchParams(window.location.search).get("referrer")}},{key:"getReferralCodeFromUrl",value:function(e){e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(window.location.href);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}},{key:"generateUid",value:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))}},{key:"getVisitorId",value:function(){return i.get(k)}},{key:"getCookieSafelink",value:function(){return i.get(S)}},{key:"getCookieSafelinkGenerated",value:function(){return i.get(O)}},{key:"getCookieReferrer",value:function(){return i.get(B)}},{key:"isReferrerBlocked",value:function(){return!!i.get(E)}},{key:"clearCookies",value:function(){i.remove(x),i.remove(k),i.remove(_),i.remove(C),i.remove(S),i.remove(O),i.remove(B),i.remove(E)}},{key:"getCookieAffiliateReferralCode",value:function(){return i.get(x)}},{key:"trigger",value:(s=v(t().mark((function e(){var n,o,r,a,s,l,c,u,d,p,f=arguments;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=f.length>0&&void 0!==f[0]?f[0]:"click",r=f.length>1&&void 0!==f[1]?f[1]:{},this.referral_code&&""!==this.referral_code){e.next=4;break}return e.abrupt("return");case 4:if(!this.isReferrerBlocked()){e.next=7;break}return console.debug("Referrer blocked"),e.abrupt("return");case 7:if(a=this.getCookieAffiliateReferralCode(),s=this.getVisitorId(),l=i.get(C),this.payload={affiliate_referral:this.referral_code,destination_url:window.location.href,event_type:o,visitor_id:s||this.generateUid(),shop_url:null===(n=Shopify)||void 0===n?void 0:n.shop,referrer:this.referrer},c=y(y({},this.payload),r),!((new Date).getTime()<l&&"click"===o)){e.next=24;break}if(a!==this.referral_code){e.next=24;break}if(console.debug("Referral already logged"),console.debug("Safelink already generated: "+this.getCookieSafelinkGenerated()),!this.getCookieSafelink()){e.next=22;break}if(!this.getCookieSafelinkGenerated()){e.next=20;break}return e.abrupt("return");case 20:return this.renderSafelinkModal(JSON.parse(this.getCookieSafelink())),e.abrupt("return");case 22:return this.applyCoupon(),e.abrupt("return");case 24:return e.next=26,this.sendData(c);case 26:if(u=e.sent,"click"!==o){e.next=44;break}if(d=u.cookie_duration,p={expires:d,secure:!0},u.cookie_domain&&(p.path="/",p.domain=".".concat(u.domain)),i.set(k,c.visitor_id,p),i.set(x,c.affiliate_referral,p),i.set(_,(new Date).getTime(),p),i.set(C,this.addDays(d).getTime(),p),i.set(B,this.referrer,p),!u.safelink){e.next=41;break}return console.debug(u.safelink),i.set(S,JSON.stringify(u.safelink),p),this.renderSafelinkModal(u.safelink),e.abrupt("return");case 41:this.referral_applied=!0,u.apply_coupon&&this.applyCoupon(),console.debug("Referral recorded");case 44:return e.abrupt("return",u);case 45:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"redirectIfExists",value:(a=v(t().mark((function e(){var n,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new URL(window.location.href),(o=n.searchParams.get("redirect"))&&this.referral_applied){e.next=4;break}return e.abrupt("return");case 4:window.location.href=o;case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"addDays",value:function(e){var t=new Date;return t.setDate(t.getDate()+e),t}},{key:"sendData",value:function(e){return fetch("".concat("https://api.socialsnowball.io","/referral"),{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){var t;return e.error?(console.debug(e.message),console.log("Failed to referral data"),void("blocked_referrer"===e.code&&i.set(E,"true",{expires:1,secure:!0}))):(((null===(t=e.safelink)||void 0===t?void 0:t.customjs)||[]).forEach((function(e){try{new Function(e)()}catch(e){console.error("Error executing command:",e)}})),e)})).catch((function(e){return console.error(e)}))}},{key:"applyCoupon",value:function(){console.debug("Applying coupon '".concat(this.referral_code,"' to cart"));var e=document.createElement("iframe");e.style.cssText="height: 0; width: 0; display: none;",e.src=new URL(encodeURI("discount/".concat(this.referral_code)),document.location.origin).href,e.innerHTML="Your browser does not support iframes",document.querySelector("body").prepend(e),console.debug("Coupon applied")}},{key:"updateSafeLinkModalSize",value:function(e,t){e=e||document.getElementById("__ss-modal-content"),t=t||document.getElementById("__ss-modal-inner"),window.innerWidth<768?(e.style.cssText+="width: 90%;",t.style.cssText+="padding: 40px 10px;"):(e.style.cssText+="width: 40%;",t.style.cssText+="padding: 40px 30px 60px 30px;")}},{key:"renderSafelinkModal",value:function(e){var t=this;new f(y(y({},e),{},{sendData:function(){return t.sendData(y(y({},t.payload),{},{create_safelink:!0}))},applyCoupon:function(e){t.referral_code=e,t.applyCoupon()},safelinkGeneratedCookie:O})).init()}}],o&&b(n.prototype,o),r&&b(n,r),Object.defineProperty(n,"prototype",{writable:!1}),e}();function L(e,t,n,o,r,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,r)}var T,I;(T=t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===window.snowballTrackScript){e.next=2;break}return e.abrupt("return");case 2:return window.snowballTrackScript=!0,n=new j,e.next=6,n.trigger();case 6:return e.next=8,n.redirectIfExists();case 8:case"end":return e.stop()}}),e)})),I=function(){var e=this,t=arguments;return new Promise((function(n,o){var r=T.apply(e,t);function i(e){L(r,n,o,i,a,"next",e)}function a(e){L(r,n,o,i,a,"throw",e)}i(void 0)}))},function(){return I.apply(this,arguments)})()})()})();